---
layout: post
title: template page
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
---


## 创建表
### 标准的建表语法
```
CREATE TABLE [schema.]tablename
(column datatype [DEFAULT expr] , …
);
```

注意
- 在创建新表时，指定的表名必须不存在，否则将出错。
- 使用默认值：<br>
	当插入行时如果不给出值，dbms将自动采用默认值。
- 在用 Create 语句创建基本表时，最初只是一个空的框架。<br>
	用户可以使用 insert 命令把数据插入表中。
	
**案例**：<br>
建立一张用来存储学生信息的表，表中的字段包含了学生的学号、姓名、年龄、入学日期、年级、班级、email等信息。<br>
并且为 grade 指定了默认值为1，如果在插入数据时不指定 grade 的值，就代表是一年级的学生。<br>
**解答**：
```
create table student
(
id number(6),
name varchar2(20),
sex number(1),
age number(3),
sdate date,
grade number(2) default 1,
class number(4),
email varchar2(50)
);
```

### 使用子查询建表
`CREATE TABLE table [column(, column...)]AS subquery;`
- 新表的字段列表必须与子查询中的字段列表**匹配**
- 字段列表可以**省略**

----------

- 复制表结构和数据<br>
	`create table table2 as select * from table1;`
- 只复制表结构，不复制数据<br>
	`create table table2 as select * from table1 where 1=2;`<br>
	因为 `select * from table1 where 1=2` 是一张空表
- 无论是哪种复制，都无法复制表的约束（外键、主键等）<br>
	当表没有主键时，oracle 将默认使用 **rownum** 作为主键

## 修改表结构
在基本表建立并使用一段时间后，可以根据实际需要对基本表的结构进行修改
- **增加新的列**<br>
	`用“alter table 表名 add 列名 数据类型;`<br>
	新增加的类不能定义为“not null”<br>
	因为基本表在增加一列后，原有元组在新增加的列上的值都是**空值**。
- **删除原有的列**<br>
	`alter table 表名 drop 列名;`
- **删除表**<br>
	- 删除普通表<br>
		`drop table student_infor;`
	- 删除带约束的表<br>
		`drop table 表名 cascade constraints;`<br>
	- 在基本表不需要时，可以使用“drop table”语句撤消。<br>
	在一个基本表撤消后，所有的数据都丢弃，所有相关的索引被删除。<br>
- **重命名列**<br>
	`alter table 表名 rename column 旧列名 to 新列名;`
- **重命名表或视图**<br>
	`rename 旧表名 to 新表名;`<br>
	可以使用RENAME语句改变表名（视图）。<br>
	要求必须是表（视图）的所有者
- **修改列的数据类型**<br>
	`alter table 表名 modify ( 列名 新的数据类型 );`

## 约束 constraint
当我们创建表的时候，同时可以指定所插入数据的一些规则，比如说<br>
某个字段不能为空值，某个字段的值（比如年龄）不能小于零……<br>
这些规则称为约束。

约束是在表上强制执行的数据校验规则。

在添加约束之前，插入语句只需要**合法**：即满足表结构的**数据类型**。<br>
在添加约束之后，插入语句还需要**合理**：即满足建表人所定义的**规范**。

----------

**Oracle 支持下面五类完整性约束**:
1. NOT NULL <br>
	非空约束<br>
	插入数据的时候某些列不允许为空。
2. UNIQUE Key <br>
	唯一键约束<br>
	可以限定某一个列的值是唯一的，唯一键的列一般被用作**索引**列。
3. PRIMARY KEY <br>
	主键<br>
	非空且唯一，任何一张表一般情况下最好有主键，用来唯一的**标识**一行记录。
4. FOREIGN KEY <br>
	外键<br>
	当多个表之间有**关联关系**（一个表的某个列的值**依赖**于另一张表的某个值）的时候，需要使用外键。
5. CHECK <br>
	自定义检查约束<br>
	可以根据用户自己的需求去限定某些列的值。


----------


**注意**：
- Oracle使用SYS_Cn格式命名约束，也可以由用户命名
	- 命名规则<br>
		约束_表名_字段 <br>
		可以保证唯一性。 如果太长，可用缩写。
- 同一字段可以有多个约束，但是约束之间不要冲突
- 创建约束的时机
	1. **在建表的同时创建**。 <br>
		**建议使用**。 <br>
		如果包含外键约束的话，最好先把**外键**关联表的数据**优先**插入。
	2. 建表后创建。
- 约束从作用上分类，可以分成两大类：
	1. 表级约束<br>
		可以约束表中的任意一列或多列。<br>
		可以定义除了Not Null以外的任何约束。
	2. 列级约束<br>
		只能约束其所在的某一列。<br>
		可以定义任何约束。



### 非空约束 not null
确保字段值不允许为空

只能在字段级定义
```
CREATE TABLE employees(
employee_id NUMBER(6),
name VARCHAR2(25) NOT NULL,
salary NUMBER(8,2),
hire_date DATE CONSTRAINT emp_hire_date_nn NOT NULL
)
```

### 唯一性约束 unique
- 唯一性约束条件确保所在的字段或者字段组合不出现重复值
- 唯一性约束条件的字段允许出现空值
- Oracle将为唯一性约束条件创建对应的唯一性索引
	```
	CREATE TABLE employees(
	id NUMBER(6),
	name VARCHAR2(25) NOT NULL UNIQUE,
	email VARCHAR2(25),
	salary NUMBER(8,2),
	hire_date DATE NOT NULL,
	CONSTRAINT emp_email_uk UNIQUE(email)
	);
	```
	
### 主键约束 primary key
主键约束是数据库中最重要的一种约束。<br>
在关系中，主键值不可为空，也不允许出现重复，即关系要满足实体完整性规则。
- 主键从功能上看相当于非空且唯一
- 一个表中只允许一个主键
- 主键是表中能够唯一确定一个行数据的字段
- 主键字段可以是单字段或者是多字段的组合
- Oracle为主键创建对应的唯一性索引

主键可用下列两种形式之一定义
1. 主键子句
	在表的定义中加上如下子句 primary key(列)
2. 主键短语
	在主属性的定义之后加上primary key字样。 
- 上述形式Oracle会自动命名约束，可自己给约束起名
	```
	 create table t3(
		id number(4), 
		constraint t3_pk primary key(id)
	)
	```

### 外键约束 foreign key
现在有学生表和成绩表。

学生表中有字段学生ID，成绩表中也有字段学生ID。

在给成绩表的学生ID设置外键约束后（参照为学生表的学生ID）。

成绩表想要插入成绩，其学生ID必须是学生表中存在的学生ID。<br>
也就是说，并不能插入**不存在**的学生的成绩。

然后当学生毕业了，或者退学了，当把该学生从学生表中删除时（删除了学生ID）。<br>
那么成绩表中对应的成绩也会被一起**清空**。

这就是外键约束。

成绩表依赖于学生表，成绩表是依赖表，学生表是主表。

成绩表中的学生ID是外键，学生表中的学生ID是主键。

- 外键是表中的一个列，其值必须在另一表的主键或者唯一键中列出
- 作为主键的表称为“主表”，作为外键的关系称为“依赖表”
- 外键参照的是主表的主键或者唯一键
- 对于主表的删除和修改主键值的操作，会对依赖关系产生影响。
	以删除为例：当要删除主表的某个记录为例，即删除一个主键值，有 3 种做法
	1. **restrict** 方式
		- 只有当依赖表中没有一个外键值与要删除的主表中主键值相对应时，才可执行删除操作。
		- 需要**手动**地修改依赖表，否则无法删除主表中的数据。
	2. **cascade** 方式
		- 将依赖表中所有外键值与主表中要删除的主键值相对应的记录一起**删除**。
		- 自动执行。
	3. **set null** 方式
		- 将依赖表中所有与主表中被删除的主键值相对应的外键值设为**空值**。
		- 自动执行。

外键的声明<br>
`foreign key (列名) reference 主表(主键或唯一键) [on delete [cascade|set null]]` <br>
如果省略 on 短语，缺省将使用 **restrict** 方式

### check约束
- Check约束用于对一个属性的值加以限制
- 在check中定义检查的条件表达式，数据需要符合设置的条件
	```
	create table emp3
	( id number(4) primary key,
	age number(2) check(age > 0 and age < 100),
	salary number(7,2),
	sex char(1),
	constraint salary_check check(salary > 0)
	)
	```
- 在这种约束下，插入记录或修改记录时，系统要测试新的记录的值是否满足条件

## 约束的添加和撤销
可增加或删除约束，但不能直接修改。

增加约束<br>
`alter table 表名 add constraint 约束名 约束类型(列名);`

删除约束<br>
`alter table 表名 drop constraint 约束名 [cascade];`

## 源码链接
该文章源码链接 [Github](url)