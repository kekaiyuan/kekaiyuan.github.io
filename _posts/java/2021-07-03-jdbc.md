---
layout: post
title: Java 之—— JDBC
categories: Java
description: Java 之—— JDBC
keywords: Java，JDBC
---

Java 之—— JDBC

## JDBC介绍
- JDBC (Java Database Connectivity) 是基于JAVA语言访问数据库的一种技术。
- JDBC是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由一组用Java语言编写的类和接口组成。<br>
	JDBC提供了一种基准，据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用程序。<br>
	同时，JDBC也是个商标名。
- JDBC的设计思想：由SUN公司(JCP)提供访问数据库的接口，由数据库厂商提供对这些接口的实现，程序员编程时都是针对接口进行编程的。
- JDBC包括一套JDBC的API和一套程序员和数据库厂商都必须去遵守的规范。
	- java.sql包：提供访问数据库基本的功能
	- javax.sql包：提供扩展的功能
- 数据库中间件
- JDBC可以做些什么？
	- 连接到数据库
	- 在Java app中执行SQL命令
	- 处理结果。


## 源码
使用 JDBC 连接数据库需要按照步骤



数据库连接池
连接10次，无限建立连接、断开连接
使用连接池，拿走连接，放回连接



 thin是连接数据库的方式

## java.sql.*
所有的数据库产商如果要与 Java 接轨，必须自定义实现以下的类
- java.sql.Driver <br>
	驱动
- java.sql.Connection<br>
	连接
- java.sql.Statement<br>
	静态处理块
- java.sql.PreparedStatement<br>
	预处理块
- java.sql.ResultSet<br>
	结果集
- java.sql.ResultSetMetaData<br>
	结果集元数据

## JDBC 访问数据库的过程
![enter description here](/images/posts/java/jdbc/process.png)

- Java.sql.DriverManager用来装载驱动程序，并且为创建新的数据库联接提供支持。
- Java.sql.Connection完成对某一指定数据库的联接
- Java.sql.Statement在一个给定的连接中作为SQL执行声明的容器，他包含了两个重要的子类型。
	- Java.sql.PreparedSatement用于执行预编译的sql声明
	- Java.sql.CallableStatement用于执行数据库中存储过程的调用
- Java.sql.ResultSet对于给定声明取得结果的途径

## JDBC 的使用方法


----------


0. 导入 jar 包<br>
	在开始之前首先得导入所使用数据库的 jar 包。
	- 可以通过 maven 或 gradle 自动导入。
	- 也可以手动导入。
		- oracle 11g 的 jar 包<br>
			- `.\Oracle\product\11.2.0\dbhome_1\jdbc\lib\ojdbc6.jar`
			- `.\Oracle\product\11.2.0\dbhome_1\oui\jlib\classes12.jar`
			- 以上两个都可以，如果其中某个报错可以换一个试试。


----------


**1. 加载驱动**<br>
	选择加载哪一个数据库的驱动程序。
	- MySQL
		```java
		Class.forName("com.mysql.jdbc.Driver");
		```
	- Oracle
		```java
		Class.forName("oracle.jdbc.driver.OracleDriver");
		```
	- PostgreSQL
		```java
		Class.forName("org.postgresql.Driver");
		```
	- DB2
		- 连接具有 DB2 客户端的 Provider 实例
			```java
			Class.forName("com.ibm.dbjdbc.app.DBDriver");
			```
		- 连接不具有 DB2 客户端的 Provider 实例
			```java
			Class.forName("com.ibm.dbjdbc.net.DBDriver");
			```
	- Microsoft SQL Server
		```java
		Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
		```
	


----------


2. 建立连接<br>
	连接数据库。<br>
	```java
	Connection connection = DriverManager.getConnection(URL, Username, Password);
	```
	参数：
	- Username<br>
		用户名
	- Password<br>
		密码
	- URL<br>
		数据库的地址<br>
		- MySQL
			```java
			// db_name 为数据库名
			String URL="jdbc:mysql://localhost:3306/db_name";
			```
		- Oracle
			```java
			// orcl 为数据库的 SID
			String URL="jdbc:oracle:thin:@localhost:1521:orcl";
			```
			有两种连接方式：
			1. thin 连接<br>
				`jdbc:oracle:thin:@<主机名或IP>:1521:<数据库SID名>；`<br>
				纯粹用Java完成数据库访问， 只要有数据库驱动包就可以直接通过网络端口访问数据库。
			2. oci 连接<br>
				`java:oracle:oci@<本地服务名>`<br>
				需要在客户端安装Oracle的客户端软件，并注册一个本地服务名。
			
			理论上 oci 性能要好于 thin 。但是通常项目中我们使用 thin 连接方式。
		- PostgreSQL
			```java
			// db_name 为数据库名
			String URL="jdbc:postgresql://localhost/db_name";
			```
		- DB2
			```java
			// db_name 为数据库名
			String URL="jdbc:db2://localhost:5000/db_name";
			```
		- Microsoft SQL Server
			```java
			// db_name 为数据库名
			String URL="jdbc:sqlserver://localhost:1433;DatabaseName=db_name";
			```


----------


3. 测试连接是否成功
	```java
	if(connection != null){
		System.out.println("连接成功");
	}else{
		System.out.println("连接失败");
	}
	```


----------


4. 定义 sql 语句<br>
	只要填写正常执行的 sql 语句即可，不要在 sql 语句中加 ; 号
	```java
	String sql = "select * from emp";
	```


----------


5. 创建静态处理块对象，用于存放 sql 语句。<br>
	该对象执行的时候，数据库会从中拿到 sql 语句并执行。
	```java
	Statement statement = connection.createStatement();
	```


----------


6. 执行sql语句，返回的是一个集合。<br>
	```java
	ResultSet resultSet = statement.executeQuery(sql);
	```
	共有三种执行方式：
	1. execute<br>
		任何SQL语句都可以执行
	2. executeQuery<br>
		只能执行查询语句
	3. executeUpdate<br>
		只能执行更新语句


----------


7. 遍历结果集合，读取数据库中的数据。<br>
	有两种读取方式：
	1. 通过**下标**索引编号，从 **1** 开始
	2. **推荐**通过**列名**来获取，因为列名一般不会发生修改

	```java
	while (resultSet.next()) {
		//读取第一列
		int anInt = resultSet.getInt(1);
		System.out.println(anInt);

		//读取 ename
		String ename = resultSet.getString("ename");
		System.out.println(ename);

		...
	}
	```


----------


8. 关闭连接
	```java
	statement.close();
	connection.close();
	```
	
	
	
	

## 源码链接
该文章源码链接 [Github](url)