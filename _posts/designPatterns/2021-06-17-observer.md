---
layout: post
title: 设计模式之——观察者Observer
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
---

Content here

# 代码
通过一个案例说明观察者的设计。

孩子是被观察者，爸爸、妈妈、小狗是观察者。

观察的事件是孩子的哭，当孩子哭时，爸爸会找食物，妈妈会抱孩子，小狗会叫。

- 抽象类事件`Event`
	```java
	abstract class Event<T> {
		T source;
		public T getSource(){
			return source;
		};
	}
	```
	- 记录细节
		- 在观察者模式有事件的概念，是因为根据细节的不同，观察者会有不同的行为，此时需要将观察时的细节记录下来，就有了事件类。例如该例子就是哭事件`CryEvent`，记录孩子在哪里哭的，在什么时间哭的...
	- 代码复用
		- `Event`类时所有具体的事件类的父类，因为可能不同的事件调用的是观察者的同一个方法，如果将观察者的方法形参写为某个具体的事件类，那么其他的事件类将无法传入方法。而如果将方法形参写为`Event`类，那么就可以实现一个方法处理多种事件。
	- 事件源`source`
		- 上面代码中的`source`代表着事件源，即事件的源头是谁发出的。在通过`Event`类完成一个方法处理多种事件的同时，我们希望能让观察者知道该事件是由谁发出的，这样观察者就可以做出一些细节上的调整。

- 具体事件类`CryEvent`
	```java
	class CryEvent<T> extends Event{

		long timestamp;
		String location;

		public CryEvent(long timestamp, String location, T source) {
			this.timestamp = timestamp;
			this.location = location;
			super.source = source;
		}

	}
	```
	- 记录哭的时间、地点、事件源

- 观察者接口
	```java
	interface Observer {

		void actionOnCry(Event event);

	}
	```
	- 定义所有观察者都需要实现的方法。

- 具体的观察者`Dad``Mom``Dog`
	```java
	class Dad implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("dad feeding...");
			}
		}

	}

	class Mom implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("mom hugging...");
			}
		}

	}

	class Dog implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("dog wang...");
			}
		}

	}
	```
- 被观察者`Child`类
	```java
	class Child {

		private List<Observer> observers = new ArrayList<>();

		//添加观察者
		{
			observers.add(new Dad());
			observers.add(new Mom());
			observers.add(new Dog());
		}

		public void cry(String location) {

			//记录事件
			CryEvent event = new CryEvent(System.currentTimeMillis(), location, this);

			//通知所有观察者
			for (Observer o : observers) {
				o.actionOnCry(event);
			}
		}

	}
	```
# 完整代码及测试
```java
	public class Main {

		public static void main(String[] args) {
			Child child = new Child();
			child.cry("bed");

			System.out.println("-------");

			Child2 child2 = new Child2();
			child2.cry("bed");
		}

	}

	class Child {

		private List<Observer> observers = new ArrayList<>();

		//添加观察者
		{
			observers.add(new Dad());
			observers.add(new Mom());
			observers.add(new Dog());
		}

		public void cry(String location) {

			//记录事件
			CryEvent event = new CryEvent(System.currentTimeMillis(), location, this);

			//通知所有观察者
			for (Observer o : observers) {
				o.actionOnCry(event);
			}
		}

	}

	class Child2 {

		private List<Observer> observers = new ArrayList<>();

		//添加观察者
		{
			observers.add(new Dad());
			observers.add(new Mom());
			observers.add(new Dog());
		}

		public void cry(String location) {

			//记录事件
			CryEvent event = new CryEvent(System.currentTimeMillis(), location, this);

			//通知所有观察者
			for (Observer o : observers) {
				o.actionOnCry(event);
			}
		}

	}

	abstract class Event<T> {

		T source;

		public T getSource() {
			return source;
		}

	}

	class CryEvent<T> extends Event {

		long timestamp;
		String location;

		public CryEvent(long timestamp, String location, T source) {
			this.timestamp = timestamp;
			this.location = location;
			super.source = source;
		}

	}

	interface Observer {

		void actionOnCry(Event event);

	}

	class Dad implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("dad feeding...");
			}
		}

	}

	class Mom implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("mom hugging...");
			}
		}

	}

	class Dog implements Observer {

		@Override
		public void actionOnCry(Event event) {
			if (event.getSource() instanceof Child) {
				System.out.println("dog wang...");
			}
		}

	}
```
- 结果
	```java
	dad feeding...
	mom hugging...
	dog wang...
	```
	
- 结论
  可以看到`Child2`和`Child`的代码一模一样，但是观察者并没有对Child2的哭作出反应。




# 代码链接
该文章源码链接[url](url)