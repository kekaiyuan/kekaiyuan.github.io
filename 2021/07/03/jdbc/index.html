<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Java 之—— JDBC &mdash; 菜鸟日记</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://kekaiyuan.github.io//2021/07/03/jdbc/"><link rel="alternate" type="application/atom+xml" title="菜鸟日记" href="https://kekaiyuan.github.io//feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/favicon.ico"><meta property="og:title" content="Java 之—— JDBC"><meta name="keywords" content="Java，JDBC"><meta name="og:keywords" content="Java，JDBC"><meta name="description" content="Java 之—— JDBC"><meta name="og:description" content="Java 之—— JDBC"><meta property="og:url" content="https://kekaiyuan.github.io//2021/07/03/jdbc/"><meta property="og:site_name" content="菜鸟日记"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2021-07-03"> <script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://kekaiyuan.github.io//" title="菜鸟日记"><span class="octicon octicon-mark-github"></span> 菜鸟日记</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://kekaiyuan.github.io//" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://kekaiyuan.github.io//categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://kekaiyuan.github.io//archives/" class=" site-header-nav-item" target="" title="归档">归档</a> <a href="https://kekaiyuan.github.io//wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://kekaiyuan.github.io//links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://kekaiyuan.github.io//about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Java 之—— JDBC"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Java 之—— JDBC</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/07/03 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://kekaiyuan.github.io//categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 4853 字，约 14 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/images/qrcode.jpg" alt="闷骚的程序员" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>Java 之—— JDBC</p><h2 id="jdbc介绍">JDBC介绍</h2><ul><li>JDBC (Java Database Connectivity) 是基于JAVA语言访问数据库的一种技术。</li><li>JDBC是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由一组用Java语言编写的类和接口组成。<br /> JDBC提供了一种基准，据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用程序。<br /> 同时，JDBC也是个商标名。</li><li>JDBC的设计思想：由SUN公司(JCP)提供访问数据库的接口，由数据库厂商提供对这些接口的实现，程序员编程时都是针对接口进行编程的。</li><li>JDBC包括一套JDBC的API和一套程序员和数据库厂商都必须去遵守的规范。<ul><li>java.sql包：提供访问数据库基本的功能</li><li>javax.sql包：提供扩展的功能</li></ul></li><li>数据库中间件</li><li>JDBC可以做些什么？<ul><li>连接到数据库</li><li>在Java app中执行SQL命令</li><li>处理结果。</li></ul></li></ul><h2 id="javasql">java.sql.*</h2><p>所有的数据库产商如果要与 Java 接轨，必须自定义实现以下的类</p><ul><li>java.sql.Driver <br /> 驱动</li><li>java.sql.Connection<br /> 连接</li><li>java.sql.Statement<br /> 静态处理块</li><li>java.sql.PreparedStatement<br /> 预处理块</li><li>java.sql.ResultSet<br /> 结果集</li><li>java.sql.ResultSetMetaData<br /> 结果集元数据</li></ul><h2 id="jdbc-访问数据库的过程">JDBC 访问数据库的过程</h2><p><img src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/images/posts/java/jdbc/process.png" alt="image" /></p><ul><li>Java.sql.DriverManager用来装载驱动程序，并且为创建新的数据库联接提供支持。</li><li>Java.sql.Connection完成对某一指定数据库的联接</li><li>Java.sql.Statement在一个给定的连接中作为SQL执行声明的容器，他包含了两个重要的子类型。<ul><li>Java.sql.PreparedSatement用于执行预编译的sql声明</li><li>Java.sql.CallableStatement用于执行数据库中存储过程的调用</li></ul></li><li>Java.sql.ResultSet对于给定声明取得结果的途径</li></ul><h2 id="jdbc-的使用方法">JDBC 的使用方法</h2><h3 id="0-导入-jar-包">0. 导入 jar 包</h3><p>在开始之前首先得导入所使用数据库的 jar 包。</p><ul><li>可以通过 maven 或 gradle 自动导入。</li><li>也可以手动导入。<ul><li>oracle 11g 的 jar 包<br /><ul><li><code class="language-plaintext highlighter-rouge">.\Oracle\product\11.2.0\dbhome_1\jdbc\lib\ojdbc6.jar</code></li><li><code class="language-plaintext highlighter-rouge">.\Oracle\product\11.2.0\dbhome_1\oui\jlib\classes12.jar</code></li><li>以上两个都可以，如果其中某个报错可以换一个试试。</li></ul></li></ul></li></ul><h3 id="1-加载驱动">1. 加载驱动</h3><p>选择加载哪一个数据库的驱动程序。</p><ul><li>MySQL<ul><li>旧版<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="o">);</span>
</code></pre></div></div></li><li>新版<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="o">);</span>
</code></pre></div></div></li></ul></li><li>Oracle<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"oracle.jdbc.driver.OracleDriver"</span><span class="o">);</span>
</code></pre></div></div></li><li>PostgreSQL<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"org.postgresql.Driver"</span><span class="o">);</span>
</code></pre></div></div></li><li>DB2<ul><li>连接具有 DB2 客户端的 Provider 实例<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.dbjdbc.app.DBDriver"</span><span class="o">);</span>
</code></pre></div></div></li><li>连接不具有 DB2 客户端的 Provider 实例<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.dbjdbc.net.DBDriver"</span><span class="o">);</span>
</code></pre></div></div></li></ul></li><li>Microsoft SQL Server<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span class="o">);</span>
</code></pre></div></div></li></ul><p>JDBC4 以后可以<strong>不装载</strong>驱动，会<strong>自动</strong>装载。<br /> 但是为了维护编程规范，建议<strong>显式</strong>地装载驱动。</p><h3 id="2-建立连接">2. 建立连接</h3><p>连接数据库。<br /></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="no">URL</span><span class="o">,</span> <span class="nc">Username</span><span class="o">,</span> <span class="nc">Password</span><span class="o">);</span>
</code></pre></div></div><p>参数：</p><ul><li>Username<br /> 用户名</li><li>Password<br /> 密码</li><li>URL<br /> 数据库的地址<br /><ul><li>MySQL<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// db_name 为数据库名</span>
  <span class="nc">String</span> <span class="no">URL</span><span class="o">=</span><span class="s">"jdbc:mysql://localhost:3306/db_name"</span><span class="o">;</span>
</code></pre></div></div></li><li>Oracle<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// orcl 为数据库的 SID</span>
  <span class="nc">String</span> <span class="no">URL</span><span class="o">=</span><span class="s">"jdbc:oracle:thin:@localhost:1521:orcl"</span><span class="o">;</span>
</code></pre></div></div><p>有两种连接方式：</p><ol><li>thin 连接<br /> <code class="language-plaintext highlighter-rouge">jdbc:oracle:thin:@&lt;主机名或IP&gt;:1521:&lt;数据库SID名&gt;；</code><br /> 纯粹用Java完成数据库访问， 只要有数据库驱动包就可以直接通过网络端口访问数据库。</li><li>oci 连接<br /> <code class="language-plaintext highlighter-rouge">java:oracle:oci@&lt;本地服务名&gt;</code><br /> 需要在客户端安装Oracle的客户端软件，并注册一个本地服务名。</li></ol><p>理论上 oci 性能要好于 thin 。但是通常项目中我们使用 thin 连接方式。</p></li><li>PostgreSQL<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// db_name 为数据库名</span>
  <span class="nc">String</span> <span class="no">URL</span><span class="o">=</span><span class="s">"jdbc:postgresql://localhost/db_name"</span><span class="o">;</span>
</code></pre></div></div></li><li>DB2<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// db_name 为数据库名</span>
  <span class="nc">String</span> <span class="no">URL</span><span class="o">=</span><span class="s">"jdbc:db2://localhost:5000/db_name"</span><span class="o">;</span>
</code></pre></div></div></li><li>Microsoft SQL Server<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// db_name 为数据库名</span>
  <span class="nc">String</span> <span class="no">URL</span><span class="o">=</span><span class="s">"jdbc:sqlserver://localhost:1433;DatabaseName=db_name"</span><span class="o">;</span>
</code></pre></div></div></li></ul></li></ul><h3 id="3-测试连接是否成功">3. 测试连接是否成功</h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="o">(</span><span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"连接成功"</span><span class="o">);</span>
<span class="o">}</span><span class="k">else</span><span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"连接失败"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="4-定义-sql-语句">4. 定义 sql 语句</h3><p>只要填写正常执行的sql语句即可<br /> 不要加 ; 号<br /></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"select * from emp"</span><span class="o">;</span>
</code></pre></div></div><h3 id="5-创建静态处理块对象">5. 创建静态处理块对象</h3><p>静态处理块对象用于存放 sql 语句，该对象执行的时候，数据库会从中拿到 sql 语句并执行。</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
</code></pre></div></div><h3 id="6-执行sql语句">6. 执行sql语句</h3><p>执行的返回值是一个集合。</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">resultSet</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div></div><p>共有三种执行方式：</p><ol><li>execute<br /> <strong>任何</strong>SQL语句都可以执行。<br /> 返回值是 boolean 型，表明执行该SQL语句是否返回了ResultSet。</li><li>executeQuery<br /> 只能执行<strong>查询</strong>语句。<br /> 返回值是一个 ResultSet，即结果集。</li><li>executeUpdate<br /> 用于执行 <strong>INSERT</strong>、<strong>UPDATE</strong> 或 <strong>DELETE</strong> 语句以及 <strong>SQL DDL</strong>（数据定义语言）语句，例如 CREATE TABLE 和 DROP TABLE。<br /> 返回值是 int 型，表示被该语句<strong>影响</strong>的行数。<br /> 对于 CREATE TABLE 或 DROP TABLE 等不操作行的语句，返回值为</li></ol><h3 id="7-读取结果">7. 读取结果</h3><p>遍历结果集合，读取数据库中的数据。</p><p>有两种读取方式：</p><ol><li>通过<strong>下标</strong>索引编号，从 <strong>1</strong> 开始</li><li><strong>推荐</strong>通过<strong>列名</strong>来获取，因为列名一般不会发生修改</li></ol><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">resultSet</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
	<span class="c1">//读取第一列</span>
	<span class="kt">int</span> <span class="n">anInt</span> <span class="o">=</span> <span class="n">resultSet</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">anInt</span><span class="o">);</span>

	<span class="c1">//读取 ename</span>
	<span class="nc">String</span> <span class="n">ename</span> <span class="o">=</span> <span class="n">resultSet</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"ename"</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ename</span><span class="o">);</span>

	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="8-关闭连接">8. 关闭连接</h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">statement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div><h2 id="预处理块-preparedstatement">预处理块 PreparedStatement</h2><p>预处理块 PreparedStatement 是静态处理块 Statement 的子类。</p><p>在实际开发中，预处理块的使用更多。</p><p>例，现在需要执行 insert 操作，将实体类 Emp 插入对应的数据库中。</p><p>使用 Statement 类</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">insert1</span><span class="o">(</span><span class="nc">Emp</span> <span class="n">emp</span><span class="o">){</span>
	<span class="o">...</span>
	<span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into emp values("</span> <span class="o">+</span>
						<span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="s">"'"</span> <span class="o">+</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEname</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="s">"'"</span> <span class="o">+</span> <span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="n">emp</span><span class="o">.</span><span class="na">getMgr</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="s">"to_date("</span> <span class="o">+</span> <span class="n">emp</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">()</span> <span class="o">+</span> <span class="s">",'YYYY/MM/DD'),"</span> <span class="o">+</span>
						<span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="n">emp</span><span class="o">.</span><span class="na">getComm</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
						<span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">()</span> <span class="o">+</span>
						<span class="s">")"</span><span class="o">;</span>

	<span class="c1">//返回值表示受影响的行数</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"受影响的行数："</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div><p>使用 PreparedStatement 类</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">insert2</span><span class="o">(</span><span class="nc">Emp</span> <span class="n">emp</span><span class="o">){</span>
	<span class="o">...</span>
	<span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into emp values(?,?,?,?,?,?,?,?)"</span><span class="o">;</span>
	<span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
	
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEmpno</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getEname</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getJob</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getMgr</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setDate</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Date</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-mm-dd"</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getHiredate</span><span class="o">()).</span><span class="na">getTime</span><span class="o">()));</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setDouble</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getSal</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setDouble</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getComm</span><span class="o">());</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="n">emp</span><span class="o">.</span><span class="na">getDeptno</span><span class="o">());</span>
	<span class="c1">//返回值表示受影响的行数</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">preparedStatement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"受影响的行数："</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div><p>PreparedStatement 类的使用步骤：</p><ol><li>定义 sql 语句，需要填充变量的地方用 ? 号代替。</li><li>创建 PreparedStatement 对象，并将 sql 语句闯入。</li><li>填充 ？号，下标从 1 开始。</li><li>执行时不需要传入 sql 语句，直接执行。</li></ol><h2 id="批处理">批处理</h2><p>PreparedStatement 类除了执行 sql 语句代码更简洁。<br /> 还有一个好处是可以进行<strong>批处理</strong>。</p><p>假如你现在需要在数据库中插入 1000 条数据，应该怎么做？<br /> 是 <strong>建立连接——插入 1 条数据——关闭连接</strong> 循环 1000 次吗？<br /> 建立和关闭连接都是需要花费系统资源和时间的，很显然不应该这么做。<br /> 我们应该 <strong>建立连接——插入 1000 条数据——关闭连接</strong>。<br /> 这就是<strong>批处理</strong>。</p><p>如何使用批处理？</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
<span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into emp(empno,ename) values (?,?)"</span><span class="o">;</span>
<span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="o">...);</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="o">...);</span>
	<span class="n">preparedStatement</span><span class="o">.</span><span class="na">addBatch</span><span class="o">();</span>
<span class="o">}</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">ints</span> <span class="o">=</span> <span class="n">preparedStatement</span><span class="o">.</span><span class="na">executeBatch</span><span class="o">();</span>
<span class="o">...</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">addBatch()</code>起到分隔语句的作用。</p><h2 id="源码链接">源码链接</h2><p>该文章源码链接 <a href="https://github.com/kekaiyuan/javaquestion/tree/main/jdbc">Github</a></p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://kekaiyuan.github.io/" target="_blank">Kaiyuan Ke</a></li><li>本文链接：<a href="https://kekaiyuan.github.io//2021/07/03/jdbc/" target="_blank">https://kekaiyuan.github.io//2021/07/03/jdbc/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2021/07/03/jdbc/', clientID: '', clientSecret: '', repo: '', owner: '', admin: [''], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:350px" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:16px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://kekaiyuan.github.io//assets/search_data.json?v=1646200238', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Kaiyuan Ke">Kaiyuan Ke</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/kekaiyuan/kekaiyuan.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://kekaiyuan.github.io//" title="首页" target="">首页</a></li><li> <a href="https://kekaiyuan.github.io//categories/" title="分类" target="">分类</a></li><li> <a href="https://kekaiyuan.github.io//archives/" title="归档" target="">归档</a></li><li> <a href="https://kekaiyuan.github.io//wiki/" title="维基" target="">维基</a></li><li> <a href="https://kekaiyuan.github.io//links/" title="链接" target="">链接</a></li><li> <a href="https://kekaiyuan.github.io//about/" title="关于" target="">关于</a></li><li><a href="https://kekaiyuan.github.io//feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/kekaiyuan/kekaiyuan.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
