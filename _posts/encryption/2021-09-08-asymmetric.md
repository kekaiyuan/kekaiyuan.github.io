---
layout: post
title: 加密
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
mermaid: true
sequence: true
---

# 非对称加密

<div class="mermaid">
sequenceDiagram
    Alice-->>John: Hello John, how are you?
    John-->>Alice: Great!
</div>

```sequence
title: 非对称加密流程
Note over A: 生成密钥对 A
A->B: 发送公钥 A
Note over B: 生成密钥对 B
B->A: 发送公钥 B
Note over A: 使用\n公钥 B 加密\n数据
A->B: 发送密文
Note over B: 使用\n私钥 B 解密\n数据
Note over B: 使用\n公钥 A 加密\n数据
B->A: 发送密文
Note over A: 使用\n私钥 A 解密\n数据
```
非对称加密的安全性极高。
- 在网络中传递的只有公钥，并没有传递私钥。
- 第三方即使获取了公钥，也是无法解开密文的，密文必须使用私钥解密。

但是非对称加密的效率极低，比对称加密慢**数千倍**。

所以往往**混合**使用
- 使用非对称加密传递对称加密的密钥
- 使用对称加密传递一般数据

## 中间人攻击
非对称加密看上去很美，但它真的就是完美无缺的了吗？

非对称加密依然可以被**破解**。
```sequence
title: 中间人攻击
participant A
participant 中间人 as C
participant B
Note over A: 生成密钥对 A
A->B: 发送公钥 A
Note over B: 生成密钥对 B
B->C: 发送公钥 B
Note over C: 截取公钥 B
Note over C: 生成密钥对 C
C->A: 发送公钥 C
Note over A: 使用\n公钥 C 加密\n数据
A->C: 发送密文
Note over C: 截取密文
Note over C: 使用\n私钥 C 解密\n数据
Note over C: 修改原始数据
Note over C: 使用\n公钥 B 加密\n修改后的数据
C->B: 发送修改后的密文
Note over B: 使用\n私钥 B 解密\n修改后的数据
Note over B: 执行错误操作
```

**真实案例**

> 南京90后小伙从网上学来了一种小技巧，只花1分钱就能成功充值上百元话费，结果因涉嫌盗窃罪被警方批捕。
> 
> 据央视新闻报道，小伙无业，在一个“薅羊毛”的聊天群里，于是“先是用1分钱充了200元成功到账，然后就开始反复充值，一共到账58笔、26000余元。”
> 
> 除了这名90后小伙，聊天群的其他数十位网友，仅仅两天就通过这个攻略，“薅”走了160多万元话费。
> 
> 经调查，江苏某电子商务公司的网上话费充值平台由于没有设置校验环节，导致支付环节存在技术漏洞，从而被黑客利用。
> 
> 日前，小刘等人因涉嫌盗窃罪，被南京市检雨花台区检察院正式批捕。

这就是中间人攻击。
- 原先
	- 甲通过平台充值 200 元话费，平台会根据甲提供的支付手段（银行卡/支付宝/微信钱包）扣除 200 元。
- 中间人攻击
	- 乙先通过平台充值 200 元话费，然后截取平台发送给支付方的消息，修改金额为 0.01 元。
	- 并且平台没有设置校验环节。
		- 我给用户充值了 200 元，但是我有没有扣除用户 200 元呢？

### 解决方法
中间人攻击的关键在哪儿？<br>
在于 B 无法分辨 A 和 C。
- A 说“我是 A”。
- C 也说“我是 A”。

在现实生活中，如何分辨一个人呢？
- 要求他出示身份证，用机器识别这张身份证是不是真的。
- 识别这个人是不是身份证上的这个人。
	- 一般地，用人眼识别真人和身份证上的图片像不像。
	- 有条件地，使用人脸识别的仪器。

那么在网络中，也有类似于身份证的东西——**证书**

最正规，最值得信赖的证书是由 **CA（数字证书颁发机构）** 颁发的。
- 这是最权威的，在互联网类似于国家背书的身份证一样。

技术能力强的程序员可以**自己实现**证书。
- 这个证书就没什么可信度了，类似于街头的小公司。
	- 有的小公司虽然小，但是是个正经公司。
	- 有的是皮包公司。
	- 有的是传销组织。
	- ......

对于合法的用户来说，他们不需要担心自己的电脑（即客户端合不合法），他们只担心访问的网站（服务器）合不合法。<br>
客户端发出请求后，服务器会在响应报文的签名中放入自己的数字证书，以便客户端检查得到的消息是否是正确的。<br>
各类浏览器都会实现对于证书的解析，有问题的会进行如下提示：<br>
![image](\images\posts\encryption\asymmetric\unsafe.png)<br>
这就是证书有问题的网站：**它无法证明自己是自己**。<br>
尽量不要使用此类网站，如果一定要使用，请注意：
- 不要填写任何有用的信息，包括但不限于
	- 个人信息
	- 任何账号密码
- 不要进行任何金钱操作。


# 源码链接
该文章源码链接 [Github](url)